\input{preamble.tex}
\textbf{\large Assignment 2: Applied Regression}\\\vspace{10pt}
\end{center}

\vspace{10pt}
\noindent
\textbf{\large Instructions:}

\vspace{10pt}
\begin{itemize}
\setlength\itemsep{0pt}
  \item {\color{red}{\textbf{Deadline}}}: \textbf{February 19, before class}
  \item Submit your work in a separate folder in your GitHub repository
  \begin{itemize}
    \item You can include only the R file or additional ones (e.g. pdf with results)
  \end{itemize}
  \item \textbf{Always use comments} in your R code -- and use them to answer questions
  \item You are encouraged to work together, but each person must submit their own code
  \item Plan is to start Part 1 in class and complete Part 2 at home
\end{itemize}

\vspace{20pt}
\tableofcontents
\newpage

% ==========================================================================
\section{Part 1: QoG Dataset}
% ==========================================================================

In this lab, we explore cross-country data from the Quality of Government (QoG) dataset. You will practice bivariate and multiple regression, demonstrate omitted variable bias, use robust standard errors, and present results with \code{modelsummary}. Follow along in class.

\subsection{Setup and data preparation}

Download the QoG Standard cross-section dataset from \href{https://www.gu.se/en/quality-government/qog-data/data-downloads/standard-dataset}{gu.se/en/quality-government/qog-data/data-downloads/standard-dataset} (CSV format).

\begin{enumerate}[label=\alph*)]
  \item Load the dataset and select the following variables. Rename them for convenience:
  \begin{itemize}
    \item \code{cname} --- country name
    \item \code{epi\_epi} --- Environmental Performance Index (EPI) score (our outcome)
    \item \code{wdi\_wip} --- share of women in parliament (\%)
    \item \code{wbgi\_gee} --- government effectiveness (World Bank governance indicator)
    \item \code{cpds\_lg} --- green party seat share in parliament (\%)
  \end{itemize}
  Suggested names: \code{country}, \code{epi}, \code{women\_parl}, \code{gov\_eff}, \code{green\_seats}.
  \item Drop observations with missing values on any of these variables. How many countries remain?
  \item Print summary statistics for all variables (e.g., using \code{summary()} or \code{skimr::skim()}).
\end{enumerate}

\subsection{Exploratory visualization}

\begin{enumerate}[label=\alph*)]
  \item Create a scatter plot of \code{women\_parl} (x-axis) vs.\ \code{epi} (y-axis).
  \item Add a linear fit using \code{geom\_smooth(method = "lm")}.
  \item In a comment, describe what you see. Is there a relationship? What is its direction?
\end{enumerate}

\subsection{Bivariate regression}

\begin{enumerate}[label=\alph*)]
  \item Run a bivariate regression: \code{lm(epi \textasciitilde{} women\_parl, data = df)}.
  \item Extract the results using \code{broom::tidy()}.
  \item Interpret the coefficient on \code{women\_parl} in a comment. What is the predicted difference in EPI between a country at the 25th percentile and one at the 75th percentile of women in parliament?
\end{enumerate}

\subsection{Multiple regression}

\begin{enumerate}[label=\alph*)]
  \item Run a multiple regression adding \code{gov\_eff} as a control: \\\code{lm(epi \textasciitilde{} women\_parl + gov\_eff, data = df)}.
  \item Compare the coefficient on \code{women\_parl} between the bivariate and multiple regression. Does it change? In what direction? Explain in a comment what this suggests.
\end{enumerate}

\subsection{Demonstrating OVB}

The omitted variable bias formula says: $\tilde{\beta}_1 = \hat{\beta}_1 + \hat{\beta}_2 \cdot \tilde{\delta}$, where $\tilde{\beta}_1$ is the bivariate coefficient, $\hat{\beta}_1$ and $\hat{\beta}_2$ are the multiple regression coefficients, and $\tilde{\delta}$ is the coefficient from regressing the omitted variable on the included variable.

\begin{enumerate}[label=\alph*)]
  \item From the regressions above, write down $\tilde{\beta}_1$ (bivariate), $\hat{\beta}_1$ (multiple), and $\hat{\beta}_2$ (multiple).
  \item Run the auxiliary regression: \code{lm(gov\_eff \textasciitilde{} women\_parl, data = df)}. Extract $\tilde{\delta}$.
  \item Verify the OVB formula: check that $\hat{\beta}_1 + \hat{\beta}_2 \times \tilde{\delta} \approx \tilde{\beta}_1$ (up to rounding).
  \item In a comment, interpret what this means: why did the coefficient on \code{women\_parl} change when we added \code{gov\_eff}?
\end{enumerate}

\subsection{Robust standard errors}

\begin{enumerate}[label=\alph*)]
  \item Using \code{modelsummary()}, print the multiple regression results with default (classical) standard errors.
  \item Now print the same model with robust standard errors: \code{modelsummary(model, vcov = "robust")}.
  \item Compare the SEs. Do they differ substantially? Do any conclusions change?
\end{enumerate}

\subsection{Presenting results}

\begin{enumerate}[label=\alph*)]
  \item Create a table comparing the bivariate and multiple regression models side by side, using robust SEs for both: \\\code{modelsummary(list(m1, m2), vcov = "robust")}.
  \item Create a coefficient plot using \code{modelsummary::modelplot()} comparing both models.
  \item Save the plot using \code{ggsave()}.
\end{enumerate}

\newpage

% ==========================================================================
\section{Part 2: Take-Home Exercises (STAR Dataset)}
% ==========================================================================

The Project STAR (Student/Teacher Achievement Ratio) experiment randomly assigned students in Tennessee to small classes (13--17 students), regular classes (22--25 students), or regular classes with a teacher's aide. We use data from this experiment to practice applied regression.

Download \code{star.csv} from the course page. Each observation is a student. Key variables include:

\begin{itemize}
  \item \code{classtype}: class type (1 = small, 2 = regular, 3 = regular + aide)
  \item \code{race}: student race (1 = White, 2 = Black, 3 = Asian, 4 = Hispanic, 5 = Native American, 6 = Other)
  \item \code{yearssmall}: years spent in a small class (0--4)
  \item \code{hsgrad}: graduated high school (0/1)
  \item \code{g4math}: 4th grade math test score
  \item \code{g4reading}: 4th grade reading test score
\end{itemize}

\subsection{Data preparation}

\begin{enumerate}[label=\alph*)]
  \item Load \code{star.csv}.
  \item Create a factor variable for \code{classtype} with labels: \code{"Small"}, \code{"Regular"}, \code{"Regular+Aide"}.
  \item Create a factor variable for \code{race} with labels: \code{"White"}, \code{"Black"}, \code{"Asian"}, \code{"Hispanic"}, \code{"Native American"}, \code{"Other"}.
  \item Create a binary variable \code{small} that equals 1 if \code{classtype == "Small"} and 0 otherwise.
  \item Report the number of observations and the number of non-missing observations for \code{g4reading} and \code{g4math}.
\end{enumerate}

\subsection{Comparing groups}

\begin{enumerate}[label=\alph*)]
  \item Calculate the mean 4th grade reading score by class type. Which group scores highest?
  \item Run a bivariate regression of \code{g4reading} on \code{small}. Interpret the coefficient.
  \item Verify that the regression coefficient equals the difference in means between small and regular+aide classes. (Hint: compare with the grouped means from part a.)
  \item Repeat the bivariate regression for \code{g4math}. Is the pattern similar?
\end{enumerate}

\subsection{Adding controls}

\begin{enumerate}[label=\alph*)]
  \item Run a multiple regression of \code{g4reading} on \code{small}, \code{race}, and \code{yearssmall}.
  \item Compare the coefficient on \code{small} with the bivariate model. Does it change much? What does this tell you about the quality of the randomization?
  \item Interpret the coefficient on \code{yearssmall}. What does it capture?
\end{enumerate}

\subsection{Interactions}

\begin{enumerate}[label=\alph*)]
  \item Does the effect of being in a small class differ by race? Fit the following model: \\\code{lm(g4reading \textasciitilde{} small * race + yearssmall, data = df)}.
  \item Print the results using \code{broom::tidy()}.
  \item What is the estimated effect of a small class for White students? For Black students? (Use the coefficients to calculate.)
  \item In a comment, discuss whether the interaction is substantively meaningful.
\end{enumerate}

\subsection{Presenting results}

\begin{enumerate}[label=\alph*)]
  \item Create a table with \code{modelsummary()} comparing all your reading score models (bivariate, multiple, interaction), using robust standard errors.
  \item Create a coefficient plot with \code{modelplot()} for the three models.
  \item Save both outputs.
\end{enumerate}

\subsection{Brief discussion}

In a comment (5--10 sentences), discuss:

\begin{enumerate}[label=\alph*)]
  \item What does the STAR data suggest about the effect of small class sizes on student achievement?
  \item Why is this evidence more credible than a typical observational study of class size?
  \item Are there any limitations or caveats based on what you observed in the data?
\end{enumerate}

\vspace{15pt}

\section{Data Sources}

\begin{itemize}
  \item \textbf{QoG Standard dataset}: \url{https://www.gu.se/en/quality-government/qog-data/data-downloads/standard-dataset}. Use the cross-section version (CSV format), or the file provided on the course page.
  \item \textbf{STAR dataset}: \code{star.csv}, provided on the course page. Original data from the Tennessee STAR experiment (Krueger, 1999).
\end{itemize}

\vspace{15pt}

\section{Submission}

Commit your \code{ps2.R} file to your GitHub repository before the deadline. Make sure your repository is public so I can access it.

Your R script should:
\begin{itemize}
  \item Be well-organized with clear section headers (using comments)
  \item Include all code needed to reproduce your analysis
  \item Include your answers and interpretations as comments
  \item Save any plots to files (e.g., using \code{ggsave()})
  \item Run without errors from top to bottom
\end{itemize}

\end{document}
