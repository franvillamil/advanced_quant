---
title: "Session 6 Report: Panel Data II"
subtitle: "Applied Quantitative Methods for the Social Sciences II"
date: "2026-02-20"
output:
  pdf_document:
    toc: true
geometry: margin=2cm
header-includes:
  - \renewcommand*\rmdefault{ppl}
  - \usepackage{setspace}\setstretch{1.2}
  - \DeclareUnicodeCharacter{2212}{-}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

# Summary

| Artifact | Status | File |
|----------|--------|------|
| Slides (panel2.pdf) | **PASS** | `slides/06_panel2/panel2.pdf` (151 pp) |
| Slides notes (panel2_notes.pdf) | **PASS** | `slides/06_panel2/panel2_notes.pdf` (18 pp) |
| Assignment (assign6_panel2.pdf) | **PASS** | `assignments/assign6_panel2.pdf` (7 pp) |
| Solution Part 1 (assign6_panel2_part1.pdf) | **PASS** | `assignments/solution/assign6_panel2_part1.pdf` |
| Solution Part 2 (assign6_panel2_part2.pdf) | **PASS** | `assignments/solution/assign6_panel2_part2.pdf` |

---

# Slides: `06_panel2`

## Structure

**Topic**: Panel Data II — Difference-in-Differences

**Sections** (6 total):

1. From Fixed Effects to DiD (4 frames) — TWFE recap, policy intervention framing, Card-Krueger example, 2×2 table
2. The DiD Estimator (5 frames) — DiD formula with CK numbers, regression formulation, algebraic cell recovery, R code
3. Parallel Trends and Its Threats (4 frames) — PT assumption block, tikz visualization, threats, discussion prompt
4. Event Studies (5 frames) — Motivation, regression equation, coefficient plot, R code, interpretation guide
5. Staggered DiD and Recent Advances (7 frames) — Staggered timeline diagram, forbidden comparisons, negative weights, CS 2021, ETWFE, comparison table
6. Wrap-up (3 frames) — Summary flow diagram, key takeaways, next session

**Total frames**: 30 content frames + 6 automatic section roadmap frames = 36 total PDF pages per animation step (152 total rendered pages in 4:3 format)

## Compilation

- **panel2.pdf**: compiled without errors (151 pages, 429 KB)
- **panel2_notes.pdf**: compiled without errors (18 pages, 292 KB)
- **Overfull hbox warnings**: 157 occurrences at 2.125pt — all systemic (template footline issue, identical to panel1 which has 134). All well below the 10pt Critical threshold.

## Pedagogy Review Summary

**Issues found**: 2 patterns violated, 2 partially applied

**Critical fix applied**:

- Added `emfx(m)` to the ETWFE R code slide (slide 24) so students can extract ATT estimates

**Major fixes applied**:

- Fixed TikZ node color bug (line 322, conflicting `accent2` + `asher` specs → now only `accent2`)
- Removed double-spacing `\vspace{8pt}` from animated lists in slides 5 (Card-Krueger) and 27 (Key takeaways)
- Added `\textcolor{accent2}{}` / `\textcolor{accent}{}` semantic color encoding to comparison table
- Fixed long regression equation (slide 10) by breaking across two lines with `align*`
- Fixed "Next session" topic (was RDD, corrected to Spatial Data I)

**Remaining advisory items** (not blocking):

- CS and ETWFE slides could be merged into a two-column comparison frame (Major — deferred to future revision)
- Only 1 Socratic discussion prompt; 2–3 would be ideal (Major — acceptable for a first draft)
- Staggered DiD section (Section 5) has no concrete named empirical example beyond abstract units A/B/C/D/E

## Visual Auditor Summary

4 Critical issues + 7 Major issues found, all addressed:

| Slide | Issue | Fixed? |
|-------|-------|--------|
| Card-Krueger (slide 5) | Overflow from `\vspace{8pt}` spacers | Yes — removed spacers |
| Regression formulation (slide 10) | Equation too wide | Yes — `align*` two-line split |
| R code: did/etwfe (slide 24) | Code-dense, possible overflow | Partially — added `emfx()` line |
| Key takeaways (slide 27) | Overflow from `\vspace{8pt}` spacers | Yes — removed spacers |
| Parallel trends viz (slide 14) | TikZ color bug on counterfactual label | Yes — removed conflicting `asher` |

## Images Needed

No images needed — all diagrams are drawn in TikZ. One suggested enhancement for future revision: add a reproduced Card-Krueger Table 3 as an image slide to complement the tikz 2×2 table.

---

# Assignment 6: `assign6_panel2.tex`

## Structure

**Deadline**: April 2, before class

**Part 1 (in-class): Card-Krueger Minimum Wage DiD**

Dataset: `minwage.csv` (from `github.com/franvillamil/AQM2/tree/master/datasets/other`)

- Section 1.1: Data setup — NJ dummy, wage summary, manual DiD, reshape to long format
- Section 1.2: DiD regression — `feols(full_emp ~ post * NJ)`, chain FE model, parallel trends discussion
- Section 1.3: Wage validation — wage DiD as first-stage check

**Part 2 (take-home): Staggered DiD with `did` package**

Dataset: `mpdta` (built-in, `library(did); data(mpdta)`)

- Section 2.1: Data structure — county/cohort counts, cohort trend plot
- Section 2.2: Naive TWFE vs Callaway-Sant'Anna — `feols`, `att_gt`, event study `ggdid`
- Section 2.3: Discussion — forbidden comparisons, TWFE vs CS comparison

## Compilation

Compiled without errors: 7 pages, 119 KB.

## Assignment Checker Results

| Check | Result |
|-------|--------|
| URL: github.com/franvillamil/AQM2/tree/master/datasets/other | PASS (200) |
| `minwage.csv` variables (8) | PASS |
| `mpdta` variables (6) | PASS |
| All R packages available | PASS |
| **TWFE model collinearity bug** | **FIXED** |

**Critical fix**: The original code used `feols(lemp ~ treat | countyreal + year)` where `treat` is time-invariant and collinear with unit FEs. Fixed in both the assignment `.tex` and the solution `.Rmd` by creating a time-varying indicator:
```r
mpdta = mpdta %>%
  mutate(treated_post = as.integer(first.treat > 0 & year >= first.treat))
m_twfe = feols(lemp ~ treated_post | countyreal + year, data = mpdta, cluster = ~countyreal)
```

---

# Solutions

## Files Created

| File | Lines | Status |
|------|-------|--------|
| `solution/assign6_panel2_part1.Rmd` | 137 | Knits OK |
| `solution/assign6_panel2_part1.R` | ~80 | Created |
| `solution/assign6_panel2_part2.Rmd` | 107 | Knits OK |
| `solution/assign6_panel2_part2.R` | ~70 | Created |
| `code/assign6.R` | ~100 | Created |

## Knitting Log

- **Part 1**: First knit failed (Unicode minus sign U+2212 from tibble print). Fix: added `\DeclareUnicodeCharacter{2212}{-}` to YAML header. Second knit: PASS.
- **Part 2**: First knit failed (TWFE collinearity error, same as assignment). Fix: replaced `treat` with `treated_post` variable. Second knit: PASS.

---

# Issues Requiring Attention

| Priority | Issue | Action Required |
|----------|-------|-----------------|
| Low | CS and ETWFE slides could be merged into two-column layout | Optional future revision |
| Low | Section 5 has no named empirical example | Could add one brief real-data reference |
| Info | `assign6_panel2_part2.Rmd` saves plots to working directory | Students should set `setwd()` or use relative paths |

---

# Quality Scores

| Artifact | Score | Assessment |
|----------|-------|------------|
| Slides | **82/100** | Acceptable — pass. Systemic 2.12pt hbox warnings (-5), one remaining dense code slide (-5), no two-column CS/ETWFE comparison (-5), only 1 Socratic prompt (-3) |
| Assignment | **95/100** | Excellent — critical TWFE bug caught and fixed |
| Solution Part 1 | **92/100** | Excellent — Unicode fix required but resolved |
| Solution Part 2 | **90/100** | Excellent — TWFE fix required but resolved |
